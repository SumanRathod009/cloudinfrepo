AWSTemplateFormatVersion: 2010-09-09
Description: 'Catalog Product: Self-service product.'

# CloudFormation parameter UI definitions
Metadata:
  Identifier:
    Value: sc-product
  Release:
    Version: '1.0'

#Input Parameters to be configured for the service catalog product 
Parameters:
  Environment:
    Type: String  
    Description: 'Environment to choose Catalog Id. Based on the selected environment, corresponding catalog will be chosen.'
    AllowedValues:
      - Dev
      - Test
      - Val
      - Prod
    ConstraintDescription: 'Can contain only alphanumeric characters, dashes and underscores up to 32 characters'
  DatabaseName:
    Type: String
    Description: 'Name of the database'
    AllowedPattern: '[a-zA-Z0-9_-]*'
    ConstraintDescription: 'Can contain only alphanumeric characters, dashes and underscores up to 32 characters'
  TableName:
    Type: String
    Description: 'Table name for which permissions to be provided, Default value is ALL_TABLES,'
    AllowedPattern: '[a-zA-Z0-9_-]*'
    ConstraintDescription: 'Can contain only alphanumeric characters, dashes and underscores up to 32 characters'
  TargetAccount:
    Description: 'Account number for which permissions to be provided'
    Type: String
    MaxLength: '50'
    AllowedPattern: '^\d{12}$'
    ConstraintDescription: 'Can contain numbers up to 12 characters.'
  Permissions:
    Description: 'Permissions for database and table.'
    Type: CommaDelimitedList
    Default: "SELECT"
  AccessType:
    Description: 'Access Type.'
    Type: String
    Default: 'grant'
  ItemId:
    Description: 'Randomly generated number'
    Type: Number
    Default: '00000'   #need to check this 
    
    
Resources:  
  TerraformLauncher:
    Type: 'Custom::TerraformLauncher'
    Properties:
      ServiceToken: !Sub 'arn:aws:lambda:${AWS::Region}:${AWS::AccountId}:function:custom_resource_lambda_7'
      StackName: !Ref 'AWS::StackName'
      ItemId: !Ref ItemId #need to check this 
      CatalogId: !Ref TargetAccount #need to check this is an accountid or not
      DatabaseName: !Ref DatabaseName
      TableName: !Ref TableName
      Permissions: !Ref Permissions
      AccessType: !Ref AccessType
      DataLakePrincipalIdentifier: "arn:aws:iam::942267903660:role/edp-collibra-testuser2" #need to check this is this a static or not 
      
              
# Outputs useful in other templates or to user
Outputs:
  TemplateVersion:
    Description: 'Template version.'
    Value: '1.0'

  TerraformLauncherStatus:
    Description: "TerraformLauncher status."
    Value: !GetAtt TerraformLauncher.status


